#!/bin/bash
#

# get git

function usage()
{
	echo "Usage: `basename ${0}` <version>"
	exit 1
}

if [ $# -ne 1 ]; then
	usage
fi

cd /tmp

curl "http://git-core.googlecode.com/files/git-${1}.tar.gz" -O
curl "http://git-core.googlecode.com/files/git-manpages-${1}.tar.gz" -O

#curl "http://kernel.org/pub/software/scm/git/git-${1}.tar.gz" -O
#curl "http://www.kernel.org/pub/software/scm/git/git-manpages-${1}.tar.gz" -O

export CC=llvm-gcc CXX=llvm-g++

# installing git
tar xzf "git-${1}.tar.gz"
cd "git-${1}"
./configure --prefix=/usr --build=x86_64-apple-darwin11.0.0
make
sudo make install

# installing shell extension
rm -f ~/.dotfiles/git/git-completion.sh
cp ./contrib/completion/git-completion.sh ~/.dotfiles/git/

cd ..

# installing man pages
sudo tar xjv -C /usr/share/man -f "git-manpages-${1}.tar.gz"

# clean up
rm -rf "git-${1}"
rm "git-${1}.tar.gz"
rm "git-manpages-${1}.tar.gz"

exit $?
